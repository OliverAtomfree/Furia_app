
{% extends 'jugadores/base.html' %}
{% block titulo %}Agregar Jugador{% endblock %}
{% block contenido %}
<div class="row justify-content-center">
    <div class="col-lg-7 col-md-9">
        <div class="text-center mb-4">
          <i class="bi bi-person-fill" style="font-size:2.5rem;color:#FFD600;"></i>
          <h1 class="fw-bold" style="color:#FFD600;">Agregar Jugador</h1>
        </div>
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-success alert-dismissible fade show" role="alert" id="msg-exito">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
        {% if form.errors %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert" id="msg-error">
            <strong>Corrige los siguientes errores:</strong>
            <ul class="mb-0">
              {% for field, errors in form.errors.items %}
                {% for error in errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              {% endfor %}
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endif %}
  <div class="card p-4 shadow-lg border-0" style="background: linear-gradient(135deg, #260D4D 60%, #7B1FA2 100%); color: #FFD600; border-radius:2rem;">
      <div class="card-body">
        <form method="post" enctype="multipart/form-data" autocomplete="off" id="form-agregar-jugador">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-12">
              <label for="usuario" class="form-label text-light fw-bold"><i class="bi bi-person-badge"></i> Usuario</label>
              <input type="text" name="usuario" id="usuario" class="form-control" placeholder="Usuario" required>
            </div>
            <div class="col-12">
              <label for="password_custom" class="form-label text-light fw-bold"><i class="bi bi-key-fill"></i> Contraseña</label>
              <input type="password" name="password_custom" id="password_custom" class="form-control" placeholder="Contraseña (mínimo 8 caracteres)" required minlength="8">
              <div class="form-text text-light">Obligatorio: introduce la contraseña que el jugador usará para iniciar sesión (mínimo 8 caracteres).</div>
            </div>
            {% for field in form %}
              <div class="col-12">
                <label for="{{ field.id_for_label }}" class="form-label text-light fw-bold">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                  <div class="text-danger small">{{ field.errors|striptags }}</div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
          <div class="d-grid gap-2 mt-4">
            <button type="button" class="btn w-100 fw-bold py-2" style="background: linear-gradient(90deg, #FFD600 60%, #7B1FA2 100%); color: #260D4D; border-radius: 1rem; box-shadow: 0 2px 8px #260D4D;" data-bs-toggle="modal" data-bs-target="#confirmModalAgregarJugador"><i class="bi bi-person-fill"></i> Guardar Jugador</button>
          </div>
        </div>
      </div>
        <!-- Modal de confirmación (dentro del formulario para que el submit sea nativo) -->
        <div class="modal fade" id="confirmModalAgregarJugador" tabindex="-1" aria-labelledby="confirmModalLabelAgregarJugador" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabelAgregarJugador" style="color: black">Confirmar registro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body" style="color: black">
                ¿Estás seguro de que deseas guardar este jugador?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <!-- Convertimos este botón en submit real para enviar el formulario con el token CSRF correctamente -->
                <button type="submit" class="btn btn-warning"><span class="bi bi-check2-circle"></span> Sí, guardar</button>
              </div>
            </div>
          </div>
        </div>
        </form>
            </div>
        </div>
        <script>
        // Enfocar el primer campo al cargar
        document.addEventListener('DOMContentLoaded', function() {
          var nombreInput = document.getElementById('id_nombre');
          if (nombreInput) nombreInput.focus();
          // Redirigir al inicio si hay mensaje de éxito
          var msgExito = document.getElementById('msg-exito');
          if (msgExito) {
            setTimeout(function() {
              window.location.href = '/'; // Cambia '/' por la URL de tu vista inicio si es diferente
            }, 1500);
          }
        });
        </script>
            </div>
        </div>
        <script>
        // Enfocar el primer campo al cargar
        document.addEventListener('DOMContentLoaded', function() {
          var nombreInput = document.getElementById('id_nombre');
          if (nombreInput) nombreInput.focus();
          // Redirigir al inicio si hay mensaje de éxito
          var msgExito = document.getElementById('msg-exito');
          if (msgExito) {
            setTimeout(function() {
              window.location.href = '/'; // Cambia '/' por la URL de tu vista inicio si es diferente
            }, 1500);
          }
        });
        </script>
{% endblock %}
